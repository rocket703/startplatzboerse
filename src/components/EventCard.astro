---
const { 
    category, 
    title, 
    date, 
    location, 
    distance, 
    price, 
    oldPrice, 
    nickname = "Gast", // Fallback, falls kein Name da ist
    id // Wichtig für den Link!
} = Astro.props;

const currentPrice = Number(price);
const previousPrice = oldPrice ? Number(oldPrice) : null;
const showSale = previousPrice !== null && previousPrice > currentPrice;
const valueText = oldPrice ? `${oldPrice}€` : null;
---

<div class="card-anchor">
    <div class="event-card">
        
        <div class="card-top-row">
            <span class="category">{category}</span>
            
            <button class="heart-btn" aria-label="Merken">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="heart-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                </svg>
            </button>
        </div>
        
        <h3>{title}</h3>
        
        <div class="location-row">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="pin-icon">
                <path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            <span>{location}</span>
        </div>

        <div class="meta-info">
            <div class="meta-row">
                <span class="label">Datum:</span> <span class="meta-value">{date}</span>
            </div>
            
            <div class="meta-row space-between">
                <div class="dist-wrapper">
                    <span class="label">Distanz:</span> <span class="meta-value">{distance || 'Startplatz'}</span>
                </div>
                
                <div class="nickname-wrapper">
                    <span class="nickname-icon">@</span>{nickname}
                </div>
            </div>
        </div>
        
        <div class="card-footer">
            <div class="price-wrapper">
                {showSale && (
                    <span class="old">{valueText}</span>
                )}
                <span class="price">{currentPrice}€</span>
            </div>
            
            <a href={`/listing/${id}`} class="details-btn">
                Details <span class="arrow">→</span>
            </a>
        </div>

    </div>
</div>

<style>
    /* --- BASIS LAYOUT --- */
    .card-anchor {
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .event-card {
        background: #111;
        padding: 25px;
        border-radius: 16px;
        border: 5px solid rgba(255,255,255,0.08);
        color: white;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
        box-sizing: border-box;
        position: relative;
    }

    .event-card:hover {
        transform: translateY(-5px);
        border-color: #00bcd4;
        box-shadow: 0 10px 30px rgba(0, 188, 212, 0.1);
    }

    /* --- KATEGORIE & HERZ --- */
    .card-top-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .category { 
        color: #00bcd4; 
        font-weight: 800; 
        font-size: 0.7rem; 
        text-transform: uppercase; 
        letter-spacing: 1.5px;
    }

    .heart-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 4px;
        color: #444;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
    }

    .heart-icon { width: 24px; height: 24px; }
    .heart-btn:hover { color: #e53935; transform: scale(1.1); }

    /* --- TITEL --- */
    h3 { 
        margin: 0; 
        font-size: clamp(1.2rem, 4vw, 1.4rem); 
        font-weight: 900; 
        letter-spacing: -0.5px;
        line-height: 1.1;
    }

    /* --- LOCATION --- */
    .location-row {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #ddd;
        font-size: 0.95rem;
        font-weight: 500;
    }
    .pin-icon { width: 16px; height: 16px; color: #e53935; flex-shrink: 0; }

    /* --- META INFOS --- */
    .meta-info {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 0.85rem;
        border-left: 2px solid #333;
        padding-left: 12px;
        margin-bottom: 10px;
    }

    .meta-row { display: flex; align-items: center; gap: 5px; }
    .meta-row.space-between { justify-content: space-between; width: 100%; }

    .label {
        color: #666;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.7rem;
    }
    .meta-value { color: #ccc; }

    /* --- NICKNAME STYLING --- */
    .nickname-wrapper {
        color: #00bcd4;
        font-size: 0.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 1px;
    }
    .nickname-icon { opacity: 0.6; font-weight: 400; }

    /* --- FOOTER --- */
    .card-footer { 
        border-top: 1px solid rgba(255,255,255,0.08); 
        padding-top: 15px; 
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto; 
    }

    .price-wrapper { display: flex; align-items: baseline; gap: 8px; }
    
    .price { 
        font-size: 1.8rem; 
        font-weight: 900; 
        color: #00bcd4; 
        filter: drop-shadow(0 0 10px rgba(0, 188, 212, 0.3));
    }
    .old { 
        text-decoration: line-through; color: #444; font-weight: 600; font-size: 1rem; 
    }

    .details-btn {
        background: #00bcd4;
        color: #000;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 0.8rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.2s ease;
        display: flex; align-items: center; gap: 6px;
    }
    .details-btn:hover { background: white; transform: translateX(2px); }
</style>